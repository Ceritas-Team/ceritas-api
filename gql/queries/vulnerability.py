import graphene
from graphene_sqlalchemy import SQLAlchemyObjectType
from ..models.vulnerability import Vulnerability
from ..models.nvd_cve import NvdCve
from .nvd_cve import NvdCveNode
from importlib import import_module

class VulnerabilityNode(SQLAlchemyObjectType):
    class Meta:
        model = Vulnerability
        interfaces = (graphene.relay.Node,)
        only_fields = (
            "id",
            "cer_id",
            "cve_reserved",
            "ics_cert_number",
            "vendor_vulnerability_id",
            "raw_vulnerability_description",
            "curated_vulnerability_description",
            "raw_mitigation_description",
            "curated_mitigation_description",
            "attack_complexity",
            "cwe",
            "cvss_score",
            "date_released",
            "date_added",
            "date_updated",
            "current_severity_history_id",
            "cve_id",
            "mitigation_links",
        )

    nvd_cve = graphene.Field(NvdCveNode)
    
    def resolve_nvd_cve(self, info):
        nvd_cve_query = NvdCveNode.get_query(info)
        return nvd_cve_query.filter(NvdCveNode.cve == self.cve).first()


    @staticmethod
    def get(info):
        return Vulnerability.query.all()